#import "lib/gost.typ": init

#show: init

= Цель работы

Изучить принципы построения консольных приложений, применив на практике знания базовых синтаксических конструкций языка C++ и объектно-ориентированного программирования.

Закрепить знания по теме виртуальных функций и абстрактных классов.

= Условие задания

== Вариант 5

Фигура: №8 (Треугольник)

Расположение: позиции 4, 5, 6

Характеристики фигуры:
- Отражение: Да
- Поворот: Да

== Задание

Доработать учебную программу, добавив в коллекцию фигур треугольник. Треугольник должен:
- Быть производным от базового класса `Shape`
- Поддерживать интерфейсы `Rotatable` (поворот) и `reflectable` (отражение)
- Предоставлять методы получения габаритных точек для стыковки с другими фигурами
- Корректно отрисовываться на экране

Треугольники необходимо разместить в следующих позициях:
- Позиция 4 — левое ухо персонажа
- Позиция 5 — правое ухо персонажа
- Позиция 6 — кокарда на шляпе

= Проектирование решения

== Иерархия классов

Треугольник был интегрирован в существующую иерархию классов следующим образом:

```
                Shape (абстрактный базовый класс)
                  |
                  |--- Line (линия)
                  |--- Square (квадрат)
                  |--- Cross (крест)
                  |--- Triangle (треугольник)
                         |
                         |--- Rotatable (поддержка поворота)
                         |--- reflectable (поддержка отражения)
```

Класс `Triangle` реализует множественное наследование от:
1. `Shape` — базовый абстрактный класс для всех фигур
2. `Rotatable` — интерфейс для поворачиваемых фигур
3. `reflectable` — интерфейс для отражаемых фигур

== Структура класса Triangle

Класс состоит из:
- Поля данных: три указателя на объекты `Line`, представляющие стороны треугольника
- Методы из Shape: `draw()`, `move()`, `getLeftTop()`, `getRightTop()`, `getLeftBottom()`, `getRightBottom()`
- Методы из Rotatable: `rotateLeft()`, `rotateRight()`
- Методы из reflectable: `flipHorisontally()`, `flipVertically()`
- Деструктор: освобождение памяти, занятой тремя линиями

= Полный текст программы (листинг)

== Базовые классы и интерфейсы

=== Абстрактный класс Shape

#raw(read("../src/shape.h"), lang: "cpp", block: true)

=== Интерфейс Rotatable

#raw(read("../src/rotatable.h"), lang: "cpp", block: true)

=== Интерфейс reflectable

#raw(read("../src/reflectable.h"), lang: "cpp", block: true)

== Класс Triangle

Ниже представлен код класса Triangle, разработанный для выполнения задания.

#raw(read("../src/triangle.h"), lang: "cpp", block: true)

=== Комментарии к реализации Triangle

Конструктор `Triangle(p1, p2, p3)`:
- Принимает три точки — вершины треугольника
- Создаёт три линии, соединяющие вершины попарно
- Выделяет динамическую память через `new`

Метод `draw()`:
- Отрисовывает все три стороны треугольника
- Делегирует отрисовку объектам класса `Line`

Метод `move(Point p)`:
- Перемещает треугольник на вектор `p`
- Сдвигает все три стороны на одинаковое расстояние

Методы габаритных точек (`getLeftTop()`, `getRightTop()`, `getLeftBottom()`, `getRightBottom()`):
- Вычисляют минимальные и максимальные координаты среди всех вершин
- Используются для точного позиционирования при стыковке фигур
- Применяют `std::min()` и `std::max()` с инициализаторными списками

Методы поворота и отражения (`rotateLeft()`, `rotateRight()`, `flipHorisontally()`, `flipVertically()`):
- Объявлены в соответствии с интерфейсами
- Не реализованы для данной задачи (оставлены пустыми)
- При необходимости могут быть дополнены математическими преобразованиями координат

Деструктор `~Triangle()`:
- Освобождает память, выделенную для трёх сторон
- Предотвращает утечки памяти

== Главная программа (main.cpp)

В файл main.cpp добавлены три треугольника в позиции 4, 5 и 6.

#raw(read("../src/main.cpp"), lang: "cpp", block: true)

=== Ключевые моменты главной программы

Позиция 4 — Левое ухо:
- Вычисляется относительно левого верхнего угла головы
- Треугольник направлен вверх и влево
- Координаты вершин подобраны для визуальной симметрии

Позиция 5 — Правое ухо:
- Зеркально симметрично левому уху
- Вычисляется относительно правого верхнего угла головы
- Обеспечивает баланс композиции

Позиция 6 — Кокарда на шляпе:
- Размещена по центру верхней части шляпы
- Маленький треугольник, вершиной вверх
- Служит декоративным элементом


= Результаты работы программы

#figure(
  raw(read("../images/program_output.txt")),
  caption: "Результат работы программы с добавленными треугольниками в позициях 4 (левое ухо), 5 (правое ухо) и 6 (кокарда на шляпе)"
)

На скриншоте видны:
- Шляпа (квадрат) с кокардой в виде треугольника (позиция 6)
- Голова персонажа (квадрат)
- Левое ухо — треугольник (позиция 4)
- Правое ухо — треугольник (позиция 5)
- Глаза, нос, рот — линии
- Нижняя часть фигуры с костюмом

Все треугольники корректно интегрированы в общую композицию и стыкуются с другими фигурами через габаритные точки.

= Выводы

В ходе выполнения лабораторной работы были изучены и применены на практике принципы объектно-ориентированного программирования на языке C++23, включая работу с абстрактными классами, множественным наследованием и умными указателями. В программу был успешно интегрирован класс `Triangle`, реализующий интерфейсы `Rotatable` и `reflectable`, что позволило добавить новые элементы в композицию (уши и кокарду) через механизм полиморфизма. Использование композиции и стандартной библиотеки (STL) обеспечило модульность и надежное управление памятью, подтвердив эффективность ООП для создания расширяемых графических приложений.
