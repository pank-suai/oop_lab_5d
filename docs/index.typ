#import "lib/gost.typ": init

#show: init

= Цель работы

Изучить принципы построения консольных приложений, применив на практике знания базовых синтаксических конструкций языка C++ и объектно-ориентированного программирования.

Закрепить знания по теме: *Виртуальные функции и абстрактные классы*.

= Условие задания

== Вариант 5

*Фигура:* №8 (Треугольник)

*Расположение:* позиции 4, 5, 6

*Характеристики фигуры:*
- Отражение: Да
- Поворот: Да

== Задание

Доработать учебную программу, добавив в коллекцию фигур треугольник. Треугольник должен:
- Быть производным от базового класса `Shape`
- Поддерживать интерфейсы `Rotatable` (поворот) и `reflectable` (отражение)
- Предоставлять методы получения габаритных точек для стыковки с другими фигурами
- Корректно отрисовываться на экране

Треугольники необходимо разместить в следующих позициях:
- *Позиция 4* — левое ухо персонажа
- *Позиция 5* — правое ухо персонажа
- *Позиция 6* — кокарда на шляпе

= Проектирование решения

== Иерархия классов

Треугольник был интегрирован в существующую иерархию классов следующим образом:

```
                Shape (абстрактный базовый класс)
                  |
                  |--- Line (линия)
                  |--- Square (квадрат)
                  |--- Cross (крест)
                  |--- Triangle (треугольник) ◄── НОВЫЙ КЛАСС
                         |
                         |--- Rotatable (поддержка поворота)
                         |--- reflectable (поддержка отражения)
```

Класс `Triangle` реализует множественное наследование от:
1. `Shape` — базовый абстрактный класс для всех фигур
2. `Rotatable` — интерфейс для поворачиваемых фигур
3. `reflectable` — интерфейс для отражаемых фигур

== Структура класса Triangle

Класс состоит из:
- *Поля данных:* три указателя на объекты `Line`, представляющие стороны треугольника
- *Методы из Shape:* `draw()`, `move()`, `getLeftTop()`, `getRightTop()`, `getLeftBottom()`, `getRightBottom()`
- *Методы из Rotatable:* `rotateLeft()`, `rotateRight()`
- *Методы из reflectable:* `flipHorisontally()`, `flipVertically()`
- *Деструктор:* освобождение памяти, занятой тремя линиями

= Полный текст программы (листинг)

== Базовые классы и интерфейсы

=== Абстрактный класс Shape

```cpp
#raw(read("../src/shape.h"), lang: "cpp", block: true)
```

=== Интерфейс Rotatable

```cpp
#raw(read("../src/rotatable.h"), lang: "cpp", block: true)
```

=== Интерфейс reflectable

```cpp
#raw(read("../src/reflectable.h"), lang: "cpp", block: true)
```

== НОВЫЙ КОД: Класс Triangle

*Этот файл полностью написан студентом для выполнения лабораторной работы.*

```cpp
#raw(read("../src/triangle.h"), lang: "cpp", block: true)
```

=== Комментарии к реализации Triangle

*Конструктор* `Triangle(p1, p2, p3)`:
- Принимает три точки — вершины треугольника
- Создаёт три линии, соединяющие вершины попарно
- Выделяет динамическую память через `new`

*Метод* `draw()`:
- Отрисовывает все три стороны треугольника
- Делегирует отрисовку объектам класса `Line`

*Метод* `move(Point p)`:
- Перемещает треугольник на вектор `p`
- Сдвигает все три стороны на одинаковое расстояние

*Методы габаритных точек* (`getLeftTop()`, `getRightTop()`, `getLeftBottom()`, `getRightBottom()`):
- Вычисляют минимальные и максимальные координаты среди всех вершин
- Используются для точного позиционирования при стыковке фигур
- Применяют `std::min()` и `std::max()` с инициализаторными списками

*Методы поворота и отражения* (`rotateLeft()`, `rotateRight()`, `flipHorisontally()`, `flipVertically()`):
- Объявлены в соответствии с интерфейсами
- Не реализованы для данной задачи (оставлены пустыми)
- При необходимости могут быть дополнены математическими преобразованиями координат

*Деструктор* `~Triangle()`:
- Освобождает память, выделенную для трёх сторон
- Предотвращает утечки памяти

== Главная программа (main.cpp)

*Модифицированный файл — добавлены три треугольника в позиции 4, 5, 6.*

```cpp
#raw(read("../src/main.cpp"), lang: "cpp", block: true)
```

=== Ключевые моменты главной программы

*Позиция 4 — Левое ухо:*
- Вычисляется относительно левого верхнего угла головы
- Треугольник направлен вверх и влево
- Координаты вершин подобраны для визуальной симметрии

*Позиция 5 — Правое ухо:*
- Зеркально симметрично левому уху
- Вычисляется относительно правого верхнего угла головы
- Обеспечивает баланс композиции

*Позиция 6 — Кокарда на шляпе:*
- Размещена по центру верхней части шляпы
- Маленький треугольник, вершиной вверх
- Служит декоративным элементом

*Управление памятью:*
- Используются умные указатели `std::shared_ptr<Shape>`
- Автоматическое освобождение памяти при выходе из области видимости
- Вектор `shapes` хранит все фигуры для последующей отрисовки

= Результаты работы программы

#figure(
  ```
  #raw(read("../images/program_output.txt"))
  ```,
  caption: "Результат работы программы с добавленными треугольниками в позициях 4 (левое ухо), 5 (правое ухо) и 6 (кокарда на шляпе)"
)

На скриншоте видны:
- Шляпа (квадрат) с кокардой в виде треугольника (позиция 6)
- Голова персонажа (квадрат)
- Левое ухо — треугольник (позиция 4)
- Правое ухо — треугольник (позиция 5)
- Глаза, нос, рот — линии
- Нижняя часть фигуры с костюмом

Все треугольники корректно интегрированы в общую композицию и стыкуются с другими фигурами через габаритные точки.

= Выводы

В ходе выполнения лабораторной работы были достигнуты следующие результаты:

1. *Освоены принципы ООП в C++:*
   - Абстрактные классы и чисто виртуальные функции
   - Множественное наследование
   - Полиморфизм через виртуальные методы
   - Управление памятью с умными указателями

2. *Реализован класс Triangle:*
   - Добавлен новый класс в иерархию фигур
   - Интегрированы интерфейсы `Rotatable` и `reflectable`
   - Реализованы все необходимые методы базового класса `Shape`
   - Обеспечена корректная работа с динамической памятью

3. *Применены принципы композиции:*
   - Треугольник строится из трёх линий
   - Используется делегирование методов компонентам
   - Достигнута модульность и переиспользование кода

4. *Решена практическая задача:*
   - Три треугольника добавлены в заданные позиции (4, 5, 6)
   - Обеспечена корректная стыковка с существующими фигурами
   - Получена визуально привлекательная композиция

5. *Закреплены навыки работы с C++23:*
   - Использование современного синтаксиса (auto, emplace_back, умные указатели)
   - Работа с STL контейнерами (std::vector)
   - Применение алгоритмов (std::min, std::max)

Разработанная программа демонстрирует мощь объектно-ориентированного подхода, позволяющего легко расширять функциональность без изменения существующего кода. Класс `Triangle` может быть в дальнейшем дополнен реализацией методов поворота и отражения, что ещё больше расширит возможности библиотеки фигур.

Все поставленные задачи выполнены успешно, программа работает корректно и соответствует требованиям варианта №5.
